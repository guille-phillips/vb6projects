0000h 
cursor_mem	DB	00H
cursor_mem_hi	DB	10H
cursor_x	DB	00H
cursor_y	DB	00H
gcursor_mem	DB	00h
gcursor_mem_hi	DB	10h
gcursor_mask	DB	80h
gcursor_x	DB	00h
gcursor_y	DB	00h
gcursor_x2	DB	00h
gcursor_y2	DB	00h
string_lo	DB	00h
string_hi	DB	00h
temp_lo		DB	00h
temp_hi		DB	00h
key_ascii	DB	00h

E0h temp
F0H operand_1 DB FFH
F1H operand_2 DB FFH
F2H lo_result 
F3H hi_result

0200H DS Hello\ this\ is\ a\ message DB 00h
0300h DS Break DB 00h

C000H
CHARACTERS

DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
 
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00000000b
DB 00011000b
DB 00000000b
 
DB 01101100b
DB 01101100b
DB 01101100b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
 
DB 00110110b
DB 00110110b
DB 01111111b
DB 00110110b
DB 01111111b
DB 00110110b
DB 00110110b
DB 00000000b
 
DB 00001100b
DB 00111111b
DB 01101000b
DB 00111110b
DB 00001011b
DB 01111110b
DB 00011000b
DB 00000000b
 
DB 01100000b
DB 01100110b
DB 00001100b
DB 00011000b
DB 00110000b
DB 01100110b
DB 00000110b
DB 00000000b
 
DB 00111000b
DB 01101100b
DB 01101100b
DB 00111000b
DB 01101101b
DB 01100110b
DB 00111011b
DB 00000000b
 
DB 00001100b
DB 00011000b
DB 00110000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
 
DB 00001100b
DB 00011000b
DB 00110000b
DB 00110000b
DB 00110000b
DB 00011000b
DB 00001100b
DB 00000000b
 
DB 00110000b
DB 00011000b
DB 00001100b
DB 00001100b
DB 00001100b
DB 00011000b
DB 00110000b
DB 00000000b
 
DB 00000000b
DB 00011000b
DB 01111110b
DB 00111100b
DB 01111110b
DB 00011000b
DB 00000000b
DB 00000000b
 
DB 00000000b
DB 00011000b
DB 00011000b
DB 01111110b
DB 00011000b
DB 00011000b
DB 00000000b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00011000b
DB 00011000b
DB 00110000b
 
DB 00000000b
DB 00000000b
DB 00000000b
DB 01111110b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00011000b
DB 00011000b
DB 00000000b
 
DB 00000000b
DB 00000110b
DB 00001100b
DB 00011000b
DB 00110000b
DB 01100000b
DB 00000000b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01101110b
DB 01111110b
DB 01110110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 00011000b
DB 00111000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 01111110b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 00000110b
DB 00001100b
DB 00011000b
DB 00110000b
DB 01111110b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 00000110b
DB 00011100b
DB 00000110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 00001100b
DB 00011100b
DB 00111100b
DB 01101100b
DB 01111110b
DB 00001100b
DB 00001100b
DB 00000000b
 
DB 01111110b
DB 01100000b
DB 01111100b
DB 00000110b
DB 00000110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 00011100b
DB 00110000b
DB 01100000b
DB 01111100b
DB 01100110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 01111110b
DB 00000110b
DB 00001100b
DB 00011000b
DB 00110000b
DB 00110000b
DB 00110000b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01100110b
DB 00111100b
DB 01100110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01100110b
DB 00111110b
DB 00000110b
DB 00001100b
DB 00111000b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00011000b
DB 00011000b
DB 00000000b
DB 00011000b
DB 00011000b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00011000b
DB 00011000b
DB 00000000b
DB 00011000b
DB 00011000b
DB 00110000b
 
DB 00001100b
DB 00011000b
DB 00110000b
DB 01100000b
DB 00110000b
DB 00011000b
DB 00001100b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 01111110b
DB 00000000b
DB 01111110b
DB 00000000b
DB 00000000b
DB 00000000b
 
DB 00110000b
DB 00011000b
DB 00001100b
DB 00000110b
DB 00001100b
DB 00011000b
DB 00110000b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 00001100b
DB 00011000b
DB 00011000b
DB 00000000b
DB 00011000b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01101110b
DB 01101010b
DB 01101110b
DB 01100000b
DB 00111100b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01100110b
DB 01111110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00000000b
 
DB 01111100b
DB 01100110b
DB 01100110b
DB 01111100b
DB 01100110b
DB 01100110b
DB 01111100b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01100000b
DB 01100000b
DB 01100000b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 01111000b
DB 01101100b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01101100b
DB 01111000b
DB 00000000b
 
DB 01111110b
DB 01100000b
DB 01100000b
DB 01111100b
DB 01100000b
DB 01100000b
DB 01111110b
DB 00000000b
 
DB 01111110b
DB 01100000b
DB 01100000b
DB 01111100b
DB 01100000b
DB 01100000b
DB 01100000b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01100000b
DB 01101110b
DB 01100110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 01100110b
DB 01100110b
DB 01100110b
DB 01111110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00000000b
 
DB 01111110b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 01111110b
DB 00000000b
 
DB 00111110b
DB 00001100b
DB 00001100b
DB 00001100b
DB 00001100b
DB 01101100b
DB 00111000b
DB 00000000b
 
DB 01100110b
DB 01101100b
DB 01111000b
DB 01110000b
DB 01111000b
DB 01101100b
DB 01100110b
DB 00000000b
 
DB 01100000b
DB 01100000b
DB 01100000b
DB 01100000b
DB 01100000b
DB 01100000b
DB 01111110b
DB 00000000b
 
DB 01100011b
DB 01110111b
DB 01111111b
DB 01101011b
DB 01101011b
DB 01100011b
DB 01100011b
DB 00000000b
 
DB 01100110b
DB 01100110b
DB 01110110b
DB 01111110b
DB 01101110b
DB 01100110b
DB 01100110b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 01111100b
DB 01100110b
DB 01100110b
DB 01111100b
DB 01100000b
DB 01100000b
DB 01100000b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01101010b
DB 01101100b
DB 00110110b
DB 00000000b
 
DB 01111100b
DB 01100110b
DB 01100110b
DB 01111100b
DB 01101100b
DB 01100110b
DB 01100110b
DB 00000000b
 
DB 00111100b
DB 01100110b
DB 01100000b
DB 00111100b
DB 00000110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 01111110b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00000000b
 
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00111100b
DB 00011000b
DB 00000000b
 
DB 01100011b
DB 01100011b
DB 01101011b
DB 01101011b
DB 01111111b
DB 01110111b
DB 01100011b
DB 00000000b
 
DB 01100110b
DB 01100110b
DB 00111100b
DB 00011000b
DB 00111100b
DB 01100110b
DB 01100110b
DB 00000000b
 
DB 01100110b
DB 01100110b
DB 01100110b
DB 00111100b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00000000b
 
DB 01111110b
DB 00000110b
DB 00001100b
DB 00011000b
DB 00110000b
DB 01100000b
DB 01111110b
DB 00000000b
 
DB 01111100b
DB 01100000b
DB 01100000b
DB 01100000b
DB 01100000b
DB 01100000b
DB 01111100b
DB 00000000b
 
DB 00000000b
DB 01100000b
DB 00110000b
DB 00011000b
DB 00001100b
DB 00000110b
DB 00000000b
DB 00000000b
 
DB 00111110b
DB 00000110b
DB 00000110b
DB 00000110b
DB 00000110b
DB 00000110b
DB 00111110b
DB 00000000b
 
DB 00011000b
DB 00111100b
DB 01100110b
DB 01000010b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 11111111b
 
DB 00011100b
DB 00110110b
DB 00110000b
DB 01111100b
DB 00110000b
DB 00110000b
DB 01111110b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00111100b
DB 00000110b
DB 00111110b
DB 01100110b
DB 00111110b
DB 00000000b
 
DB 01100000b
DB 01100000b
DB 01111100b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01111100b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00111100b
DB 01100110b
DB 01100000b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 00000110b
DB 00000110b
DB 00111110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00111110b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00111100b
DB 01100110b
DB 01111110b
DB 01100000b
DB 00111100b
DB 00000000b
 
DB 00011100b
DB 00110000b
DB 00110000b
DB 01111100b
DB 00110000b
DB 00110000b
DB 00110000b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00111110b
DB 01100110b
DB 01100110b
DB 00111110b
DB 00000110b
DB 00111100b
 
DB 01100000b
DB 01100000b
DB 01111100b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00000000b
 
DB 00011000b
DB 00000000b
DB 00111000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00111100b
DB 00000000b
 
DB 00011000b
DB 00000000b
DB 00111000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 01110000b
 
DB 01100000b
DB 01100000b
DB 01100110b
DB 01101100b
DB 01111000b
DB 01101100b
DB 01100110b
DB 00000000b
 
DB 00111000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00111100b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00110110b
DB 01111111b
DB 01101011b
DB 01101011b
DB 01100011b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 01111100b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00111100b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00111100b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 01111100b
DB 01100110b
DB 01100110b
DB 01111100b
DB 01100000b
DB 01100000b
 
DB 00000000b
DB 00000000b
DB 00111110b
DB 01100110b
DB 01100110b
DB 00111110b
DB 00000110b
DB 00000111b
 
DB 00000000b
DB 00000000b
DB 01101100b
DB 01110110b
DB 01100000b
DB 01100000b
DB 01100000b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 00111110b
DB 01100000b
DB 00111100b
DB 00000110b
DB 01111100b
DB 00000000b
 
DB 00110000b
DB 00110000b
DB 01111100b
DB 00110000b
DB 00110000b
DB 00110000b
DB 00011100b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 01100110b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00111110b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00111100b
DB 00011000b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 01100011b
DB 01101011b
DB 01101011b
DB 01111111b
DB 00110110b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 01100110b
DB 00111100b
DB 00011000b
DB 00111100b
DB 01100110b
DB 00000000b
 
DB 00000000b
DB 00000000b
DB 01100110b
DB 01100110b
DB 01100110b
DB 00111110b
DB 00000110b
DB 00111100b
 
DB 00000000b
DB 00000000b
DB 01111110b
DB 00001100b
DB 00011000b
DB 00110000b
DB 01111110b
DB 00000000b
 
DB 00001100b
DB 00011000b
DB 00011000b
DB 01110000b
DB 00011000b
DB 00011000b
DB 00001100b
DB 00000000b
 
DB 00011000b
DB 00011000b
DB 00011000b
DB 00000000b
DB 00011000b
DB 00011000b
DB 00011000b
DB 00000000b
 
DB 00110000b
DB 00011000b
DB 00011000b
DB 00001110b
DB 00011000b
DB 00011000b
DB 00110000b
DB 00000000b
 
DB 00110001b
DB 01101011b
DB 01000110b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
DB 00000000b
 
DB 11111111b
DB 11111111b
DB 11111111b
DB 11111111b
DB 11111111b
DB 11111111b
DB 11111111b
DB 11111111b

bit_positions
DB 10000000b
DB 01000000b
DB 00100000b
DB 00010000b
DB 00001000b
DB 00000100b
DB 00000010b
DB 00000001b

reset
CLI
os_entry
LDX #20h
JSR set_screen_width
LDX #20h
JSR set_screen_height
JSR test_line
JMP loop

test_line
LDX #0d
STX gcursor_x
LDY #0d
STY gcursor_y

LDX #20d
STX gcursor_x2
LDY #130d
STY gcursor_y2

JSR draw_line

LDX #100d
STX gcursor_x2
LDY #150d
STY gcursor_y2

JSR draw_line
RTS

LDA #09h
AND #0Fh
SED
ADC #00h
CLD
CMP #0Ah
ADC #48d
JSR output_ascii_char
JMP loop

LDX #10d
LDY #10d
STX gcursor_x
STY gcursor_y
JSR set_pixel_pos
JSR plot_pixel
JMP loop


fill_nybbles
LDY #0h
next_row
LDX #0h
next_column

TYA
ASL A
ASL A
ASL A
ASL A
CLC
ADC #1d
STA FFh
TXA
ASL A
ASL A
ASL A
ASL A
SED
SEC
SBC FFh
PHP
PLA
LSR A
LSR A
LSR A
LSR A
AND #04h
CLD

JSR show_nybble
JSR cursor_right
INX
CPX #10h
BNE next_column
JSR cursor_new_line
INY
CPY #10h
BNE next_row
RTS


fill_screen
LDA #00h
STA gcursor_x
LDA #00h
STA gcursor_y
next_pixel
SED
SEC
LDA gcursor_x
SBC gcursor_y
PHA
PLA
AND #01h
CLD
BEQ no_pixel
JSR set_pixel_pos
JSR plot_pixel
no_pixel
INC gcursor_x
BNE next_pixel
INC gcursor_y
BNE next_pixel
RTS

show_nybble
AND #0Fh
SED
CLC
ADC #90h
ADC #40h
CLD
JSR output_ascii_char
RTS

set_screen_width
LDA #01h
STA FE00h
STX FE01h
RTS

set_screen_height
LDA #06h
STA FE00h
STX FE01h
RTS



message
LDX #00h
LDY #02h
JSR output_string
loop
JMP loop

output_string
STX string_lo
STY string_hi
LDY #00h
CLV
next_char
LDA (string_lo),Y
BEQ output_string_exit
JSR output_ascii_char
JSR cursor_right
INY
BVC next_char
output_string_exit
RTS

cursor_right
CLC
LDA #8d
ADC cursor_mem
STA cursor_mem
LDA #0d
ADC cursor_mem_hi
STA cursor_mem_hi
RTS

cursor_left
SEC
LDA cursor_mem
SBC #8d
STA cursor_mem
LDA cursor_mem_hi
SBC #0d
STA cursor_mem_hi
RTS

cursor_up
CLC
LDA #8d
ADC cursor_mem
STA cursor_mem
LDA #0d
ADC cursor_mem_hi
STA cursor_mem_hi
RTS

cursor_down
CLC
LDA #00h
ADC cursor_mem
STA cursor_mem
LDA #01h
ADC cursor_mem_hi
STA cursor_mem_hi
RTS

set_cursor_pos

RTS

cursor_new_line
LDA #0d
STA cursor_mem
SEC
LDA cursor_mem_hi
ADC #0d
STA cursor_mem_hi
RTS

output_ascii_char
SEC
SBC #20h

output_char
STA temp_lo
PHA
TYA
PHA
TXA
PHA
LDA #00h
STA temp_hi
ASL temp_lo
ROL temp_hi
ASL temp_lo
ROL temp_hi
ASL temp_lo
ROL temp_hi
CLC
LDA temp_hi
ADC #C0h
STA temp_hi
LDY #07h
next_byte
LDA (temp_lo),Y
STA (cursor_mem),Y
DEY
BPL next_byte
PLA
TAX
PLA
TAY
PLA
RTS

plot_pixel
LDY #0h
LDA gcursor_mask
ORA (gcursor_mem),Y
STA (gcursor_mem),Y
RTS

set_pixel_pos
LDX gcursor_x
LDY gcursor_y
TXA
AND #F8h
STA gcursor_mem
TXA
AND #07h
TAX
LDA bit_positions,X
STA gcursor_mask
TYA
AND #07h
ORA gcursor_mem
STA gcursor_mem
TYA
AND #F8h
LSR A
LSR A
LSR A
CLC
ADC #10h
STA gcursor_mem+1h
RTS

pixel_left
ASL gcursor_mask
BCC pixel_left_exit
ROL gcursor_mask
LDA gcursor_mem
SBC #8h
STA gcursor_mem
LDA gcursor_mem_hi
SBC #0h
STA gcursor_mem_hi
pixel_left_exit
RTS

pixel_right
LSR gcursor_mask
BCC pixel_right_exit
ROR gcursor_mask
CLC
LDA gcursor_mem
ADC #8h
STA gcursor_mem
LDA gcursor_mem_hi
ADC #0h
STA gcursor_mem_hi
pixel_right_exit
RTS

pixel_up
LDA gcursor_mem
AND #00000111b
BEQ pixel_up_row_up
DEC gcursor_mem
RTS
pixel_up_row_up
DEC gcursor_mem_hi
LDA gcursor_mem
ORA #00000111b
STA gcursor_mem
RTS

pixel_down
LDA gcursor_mem
AND #00000111b
EOR #00000111b
BEQ pixel_down_row_down
INC gcursor_mem
RTS
pixel_down_row_down
INC gcursor_mem_hi
LDA gcursor_mem
AND #11111000b
STA gcursor_mem
RTS

acc DW 0000h
deltax DB 00h
deltay DB 00H

draw_line
LDA gcursor_x2
SEC
SBC gcursor_x
STA deltax

LDA gcursor_y2
SEC
SBC gcursor_y
STA deltay

CMP deltax
BCS draw_line_next_y

SEC
LDA #0d
SBC deltax
STA acc
LDA #0d
SBC #0d
STA acc+1d

draw_line_next_x
JSR plot_pixel
LDA acc
SEC
ADC deltay
STA acc
LDA acc+1d
ADC #0d
STA acc+1d
HALT
BMI draw_line_next_point_x
LDA acc
SEC
SBC deltax
STA acc
LDA acc+1d
SBC #0d
STA acc+1d
JSR pixel_down
INC gcursor_y

draw_line_next_point_x
JSR pixel_right
INC gcursor_x
LDA gcursor_x
CMP gcursor_x2
BNE draw_line_next_x
JSR plot_pixel
RTS

draw_line_next_y
LDA deltay
STA acc
LDA #0d
STA acc+1d

draw_line_next_y
JSR plot_pixel
LDA acc
CLC
SBC deltax
STA acc
LDA acc+1d
SBC #0d
STA acc+1d
BPL draw_line_next_point_y
LDA acc
CLC
ADC deltay
STA acc
LDA acc+1d
ADC #0d
STA acc+1d
JSR pixel_right
INC gcursor_x

draw_line_next_point_y
JSR pixel_down
INC gcursor_y
LDA gcursor_y
CMP gcursor_y2
BNE draw_line_next_y
JSR plot_pixel
RTS

multiply
LDA #0h
STA lo_result
STA hi_result
LDX #9h
CLC
next_bit
ROR hi_result
ROR lo_result
DEX
BEQ exit
LSR operand_1
BCC next_bit
CLC
LDA hi_result
ADC operand_2
STA hi_result
JMP next_bit
exit
DB 02H

nmi_service
RTI

irq_service
PHA
TXA
PHA
TYA
PHA
TSX
LDA 104h,X
AND #00010000b
BNE break_irq
LDA KEY_CODE
JSR output_ascii_char
JSR cursor_right
PLA
TAX
PLA
TAY
PLA
RTI

break_irq
LDX #00h
LDY #03h
JSR output_string
RTI

FE00h CRTC_Register
FE01h CRTC_Value
FE02h KEY_CODE DB 00h

FFFAh VECTOR_NMI DW nmi_service
FFFCh VECTOR_RESET DW reset
FFFEh VECTOR_IRQ DW irq_service
